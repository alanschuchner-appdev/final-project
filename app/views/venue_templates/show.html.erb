<h1>
  <%= @venue.name %>
</h1>
<h3 class="text-warning">
  Rating <i class="fas fa-star"></i> <%= number_with_precision(@avg_rating, precision:2) %>
</h3>

<form action="/ratings/new">

<input type="hidden" name="player_id" value="<%= current_player.id %>">
<input type="hidden" name="venue_id" value="<%= @venue.id %>"> 

<button class="btn btn-primary">Rate this venue</button>

</form>

<div class="container">
  <div class="row">
      <div class="col-sm-2"></div>
      <div class="col-sm-8">
        <script src="https://maps.googleapis.com/maps/api/js?v=3.exp&key=AIzaSyB_nAWVr-18Oi_XoadzVHmNT2vevvJfev4"></script>
        <script>
          var map;
          function initialize() {
            
              <% street_address = @venue.address %>
              <% url_safe_street_address = URI.encode(street_address) %>
              
              <% url_api="https://maps.googleapis.com/maps/api/geocode/json?address=" << url_safe_street_address.gsub(" ","+") << "&key=AIzaSyAtrPfaL0aDC2xnc92gfO0F9Es-YnbS4C4" %>
              <% raw_data=open(url_api).read %>
              <% parsed_data=JSON.parse(raw_data) %>
              
              
              <% lat = parsed_data.dig("results", 0, "geometry", "location", "lat") %>
              <% long = parsed_data.dig("results", 0, "geometry", "location", "lng") %>
            
            var MyCenter = new google.maps.LatLng(<%= lat %>,<%= long %>);
            
            var Venue<%= @venue.id %> = new google.maps.LatLng(<%= lat %>,<%= long %>);
              
            
            var mapOptions = {
              zoom: 14,
              center: MyCenter
            };
            map = new google.maps.Map(document.getElementById('map-canvas'),
            mapOptions);
            
            var marker = new google.maps.Marker({
              position: Venue<%= @venue.id %>,
              map: map,
              title: '<%= @venue.name %>'
            });
          
          }
          google.maps.event.addDomListener(window, 'load', initialize);
        </script>
        <div id="map-canvas" style="width: 100%; height: 400px"></div>
        
      </div>
      <div class="col-sm-2"></div>
    </div>

<hr>

<h2 class="card card-header bg-success text-white">
  Fields available
</h2>

<table class="table table-striped">
  <thead>
    <tr>
      <th scope="col">Name</th>
      <th scope="col">Capacity</th>
      <th scope="col">Price</th>
      <th scope="col"></th>
    </tr>
  </thead>

  <% @venue.fields.each do |field| %>
  
    <tr>
      <th scope="row"><%= field.name %></th>
      <td><%= field.capacity %> people</td>
      <td>$<%= field.price %></td>
      <td>
        <form action="/timeslots_fields">
        
        <input type="hidden" name="team_id" value="<%= Team.find(current_player.team_id).id %>">
        <input type="hidden" name="field_id" value="<%= field.id %>">
        
        <button  class="btn btn-primary">See available time slots</button>
        
        </form>
      </td>
    </tr>
    
  <% end %>
</table>
